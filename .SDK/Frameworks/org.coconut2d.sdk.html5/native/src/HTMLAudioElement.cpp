//
//  HTMLAudioElement.cpp
//  CocoEngine
//
//  Created by Administrator on 1/22/14.
//
//

#include "HTMLAudioElement.hpp"

////////////////////////////////////////////////////////////////////////////////////////////////////
Audio::Audio(String url)
{
	src = url;
	stream = new fxAudioStream(src.c_str());
}

////////////////////////////////////////////////////////////////////////////////////////////////////
Audio::~Audio()
{
	delete stream;
	trace("Delete Audio " + src);
}

////////////////////////////////////////////////////////////////////////////////////////////////////
void Audio::tick()
{
	if(stream)
	{
		stream->_tick();
		if(stream->isStopped())
		{
			ended = true;
			paused = false;
		}
		else if(stream->isPaused())
		{
			ended = false;
			paused = true;
		}
	}
}

////////////////////////////////////////////////////////////////////////////////////////////////////
void Audio::play()
{
	if(stream)
		stream->play();
	//__Audio_play(__uid);
}

////////////////////////////////////////////////////////////////////////////////////////////////////
void Audio::pause()
{
	if(stream)
		stream->stop();
	//__Audio_pause(__uid);
}

////////////////////////////////////////////////////////////////////////////////////////////////////
float Audio::get_currentTime()
{
	if(!stream)
		return 0.0f;

	return stream->get_position();
}

////////////////////////////////////////////////////////////////////////////////////////////////////
void Audio::set_currentTime(float time)
{
	if(stream)
		stream->set_position(time);
}

////////////////////////////////////////////////////////////////////////////////////////////////////
int Audio::get_readyState()
{
	return 4;
}